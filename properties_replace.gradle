//读取文件并替换字符串
def fileReader(path, oldStr, newStr) {
    def readerString = "";
    new File(path).withReader('UTF-8') { reader ->
        reader.eachLine {
            if (it.find(oldStr)) {
                it = it.replace(oldStr, newStr)
            }
            readerString <<= it
            readerString << '\n'
        }
        return readerString
    }
}
//写文件
def fileWrite(path, stringBuffer) {
    new File(path).withWriter('UTF-8') {
        within ->
            within.append(stringBuffer)
    }
}
//替换文件的字符串
task replaceConstants << {
    def file = buildDir.getAbsolutePath() + '\\resources\\main\\application.properties'
//    def file = buildDir.getAbsolutePath() + '\\resources\\application.properties'
    def versionR=project.version.replace(".","-");
    def strBuffer = fileReader(file, "@application.version@", versionR);
    fileWrite(file, strBuffer);

    def strBufferNmae = fileReader(file, "@application.name@", project.name);
    fileWrite(file, strBufferNmae);

    def strBufferProfle = fileReader(file, "@application.profile@", profile);
    fileWrite(file, strBufferProfle);
}

compileJava.dependsOn(processResources)
jar.dependsOn replaceConstants

//compileJava.dependsOn(processResources)
//processResources {
//    filesMatching("${project.projectDir}/src/main/resources/application.properties") {
//        expand(project.properties)
//    }
//}